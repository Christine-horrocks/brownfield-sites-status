{% extends "dlf-base.html" %}

{% set mainClasses = "govuk-main-wrapper--l" %}

{% block content %}
<span class="govuk-caption-xl">Validation result</span>
<h1 class="govuk-heading-xl">
  {{ data.organisation | map_la_code_to_name }}
</h1>

<p class="govuk-body"><span>Last updated:</span> {{ data.result.last_updated }}</p>
<p class="govuk-body"><a href="{{ data.url }}">See raw results</a></p>

{% if data.result.latestValidationResult | length > 0 %}

	<h2 class="govuk-heading-l">Validation errors</h2>

	<div class="govuk-grid-row">
		<div class="govuk-grid-column-one-third">
			<h4 class="subnav__heading">Rows with errors</h4>
			<ul class="govuk-list">
			{% for row in data.result.latestValidationResult %}
				{% set row_number = loop.index %}
				{% if row.validator.isRowValid == false %}
				<li><a href="#row-{{ row_number }}-errors" class="govuk-link">Row {{ row_number }}</a></li>
				{% endif %}
			{% endfor %}
			</ul>
		</div>
		<div class="govuk-grid-column-two-thirds">
			<ul class="govuk-list">
			{% for row in data.result.latestValidationResult %}
				{% set row_number = loop.index %}

				{% if row.validator.isRowValid == false %}
				<li>
					<ul id="row-{{ row_number }}-errors" class="govuk-list">
						{% for error in row.validator.rowErrors %}
						<li><span class="govuk-tag govuk-tag--error">Row {{ row_number }}</span> Field: <span class="govuk-!-font-weight-bold">{{ error.dataPath | strip('.') }}</span> {{ error.message }}</li>
						{% endfor %}
					</ul>
				</li>
				{% endif %}

			{% endfor %}
			</ul>
		</div>
	</div>

{% else %}
	No results available
{% endif %}

{% endblock %}

{% block bodyEnd %}
<script>
	console.log('{{ data }}');
</script>
{% endblock %}
